{% paginate collection.products by 12 %}
    <header role="banner">
        <h1>{{ collection.title }}</h1>
        {% if collection.description != blank %}
            <div class="rte">
                {{ collection.description }}
            </div>
        {% endif %}
    </header>

    <div class="products-container">
        <div class="filters">
            <div class="clearfix filter">
                <p>Filter by tag:</p>
                <select class="coll-filter">
                    <option value="">All</option>
                    {% for tag in collection.all_tags %} {% if current_tags contains tag %}
                        <option value="{{ tag | handle }}" selected>{{ tag }}</option>
                    {% else %}
                        <option value="{{ tag | handle }}">{{ tag }}</option>
                    {% endif %} {% endfor %}
                </select>
            </div>
        </div>
        <div class="collection-wrapper">
            {% for product in collection.products %}
                <div class="collection-wrapper__item">
                    {% if product.featured_image != blank %}
                        <a href="{{ product.url | within: collection }}">
                            {% include 'responsive-image' with
                                image: product.featured_image,
                                max_width: 700,
                                max_height: 800 %}
                        </a>
                    {% endif %}

                    <p>
                        <a href="{{ product.url | within: collection }}">{{ product.title }}</a>
                    </p>
                    <p>
                        {% if product.compare_at_price > product.price %}

                            {% if product.price_varies %}
                                {%- assign sale_price = product.price | money -%}
                                {{ 'products.product.on_sale_from_html' | t: price: sale_price }}
                            {% else %}
                                {{ 'products.product.on_sale' | t }}
                                {{ product.price | money }}
                            {% endif %}

                        {% else %}

                            {% if product.price_varies %}
                                {%- assign price = product.price | money -%}
                                {{ 'products.product.from_text_html' | t: price: price }}
                            {% else %}
                                {{ product.price | money }}
                            {% endif %}

                        {% endif %}

                        {% if product.compare_at_price > product.price %}
                            <span class="visually-hidden">{{ 'products.product.regular_price' | t }}</span>
                            <s>{{ product.compare_at_price | money }}</s>
                        {% endif %}

                        {% unless product.available %}
                            {{ 'products.product.sold_out' | t }}
                        {% endunless %}
                    </p>
                </div>

            {% else %}
                {% if collection.handle == 'all' and collection.all_vendors.size == 0 and collection.all_types.size == 0 %}
                    {% for i in (1..8) %}
                        <a href="#">
                            {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
                            {{ 'product-' | append: current | placeholder_svg_tag: 'placeholder-svg placeholder-svg--small' }}
                        </a>

                        <p>
                            <a href="#">{{ 'homepage.onboarding.product_title' | t }}</a>
                        </p>

                        <p>
                            {{ 1999 | money }}
                        </p>
                    {% endfor %}
                {% else %}
                    <p>{{ 'collections.general.no_matches' | t }}</p>
                {% endif %}

            {% endfor %}
        </div>
    </div>

    {% if paginate.pages > 1 %}
        {% include 'pagination' %}
    {% endif %}


{% endpaginate %}

<script>
    /* Product Tag Filters - Good for any number of filters on any type of collection pages */
    const collFilters = document.querySelectorAll('.coll-filter');

    if (collFilters.length > 0) {
        collFilters.forEach((collFilter) => {
            collFilter.addEventListener('change', function () {
                var newTags = [];
                collFilters.forEach((collFilter) => {
                    for (var i = 0; i <= collFilter.length - 1; i++) {
                        if (collFilter[i].selected == true && collFilter[i].value != "") {
                            newTags.push(collFilter[i].value);
                        }
                    }
                });

                if (newTags.length) {
                    var query = newTags.join('+');
                    window.location.href = '/collections/{{ collection.handle }}/' + query;
                } else {
                    {% if collection.handle %}
                    window.location.href = '/collections/{{ collection.handle }}';
                    {% elsif collection.products.first.type == collection.title %}
                    window.location.href = '{{ collection.title | url_for_type }}';
                    {% elsif collection.products.first.vendor == collection.title %}
                    window.location.href = '{{ collection.title | url_for_vendor }}';
                    {% endif %}
                }
            });
        });
    }
</script>
